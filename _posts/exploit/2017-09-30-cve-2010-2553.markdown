---
layout:		post
title:		CVE-2010-2553分析 & 复现
author:		wooy0ung
tags:		cve
category:  	exploit
---


>[分析环境]  
>系统: Windows XP SP3  
>漏洞软件: Windows Media Player 10.00.00.3802  
>注意: Windows XP SP3默认安装Windows Media Player 9, 需要升级到10否则出现崩溃无法调试。  
>说明: 这算是一个拒绝服务的洞, 无法控制EIP。
<!-- more -->


### 0x00 定位崩溃点

启动Windows Media Player, windbg附加上去, 开启页堆后打开poc.avi

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x00.png)

在rep movsd指令断下, 要是无法开启页堆可以参考另一篇文

#### 传送门: [解决windbg"your debugger is not using the correct symbols"错误](http://www.wooy0ung.me/note/2017/09/30/windbg-no-symbols/)

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x01.png)

栈回溯, 定位到iccvid!Decompress+0x11d

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x02.png)

反编译这个函数, 发现一个疑似关键call

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x03.png)

重新载入, 在iccvid模块下断

```
> sxe ld:iccvid
```

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x03.png)

在0x73b7cbee下断, 注意这里可能断不下, 多试几次就可以了

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x04.png)


### 0x01 单步跟踪

查看传入的参数, 跟进去

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x05.png)
![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x06.png)

CVDI长度是否大于0x20, 上面的0x68就是CVDI长度, 所以是大于0x20的

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x07.png)

关于CVID的结构如下图

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x08.png)

再看看Frame Header的结构

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x09.png)

```
Flag = 00
CVID数据长度 = 00 00 68
编码帧 = 01 60
编码帧高度 = 01 20
编码条数量 = 00 10
```

然后是编码条数据, 包含Header+CVID Chunk

![](/assets/img/exploit/2017-09-30-cve-2010-2553/0x0a.png)

```
编码条ID = 10 00
编码条数据大小 = 00 10
顶部Y坐标 = 00 00
顶部X坐标 = 00 00
底部Y坐标 = 00 60
底部Y坐标 = 01 60
CVID Chunk ID = 20 00
Chunk 数据大小 = 00 00
CVID Chunk ID = 11 00
Chunk 数据大小 = 00 10
Chunk 数据 = AAAAAAAAAAAA
CVID Chunk ID = 11 00
Chunk 数据大小 = 00 10
Chunk 数据 = AAAAAAAAAAAA
CVID Chunk ID = ...
```

分析就到这里吧, 后面就是控制循环次数, copy数据过大导致堆溢出...



